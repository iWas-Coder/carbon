#+AUTHOR: Wasym A. Alonso
#+TITLE: Carbon

#+CAPTION: Carbon logo
[[assets/logo.png]]

# Repository info badges
#+begin_html
<p>
<a href="https://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="GNU GPL v3.0"></a>
</p>
#+end_html

(...)

# GNU GPLv3+ License notice
#+begin_quote
This work and all its documentation is licensed under the Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0) License. @@html:<br>@@
This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. @@html:<br>@@
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
#+end_quote

* Table of Contents :toc:
- [[#usage][Usage]]
  - [[#target-code][Target code]]
  - [[#test-code][Test code]]
  - [[#test-suite-entrypoint][Test suite entrypoint]]
- [[#code-coverage][Code coverage]]

* Usage

(...)

#+begin_src sh
$  git submodule add https://github.com/iWas-Coder/carbon vendor/carbon
#+end_src

** Target code

(...)

#+begin_src c
// include/x.h

#pragma once

void inc_int(int *x);
#+end_src

#+begin_src c
// src/x.c

#include <x.h>

void inc_int(int *x) {
  ++(*x);
}
#+end_src

(...)

- ~$CC~ :: ~gcc~
- ~$CPPFLAGS~ :: ~-I include~
- ~$CFLAGS~ :: ~-Wall -Wextra -pedantic -Werror -fanalyzer~
- ~$CCOVFLAGS~ :: ~-fprofile-arcs -ftest-coverage~
#+begin_src sh
$  $CC $CPPFLAGS $CFLAGS $CCOVFLAGS -c src/x.c -o build/x.o
#+end_src

(...)

- ~$AR~ :: ~ar -rc~
#+begin_src sh
$  $AR libx.a build/*.o
#+end_src

** Test code

(...)

#+begin_src c
// test/include/x_test.h

#pragma once

void x_test_register(void);
#+end_src

(...)

#+begin_src c
// test/src/x_test.c

#define CARBON_IMPLEMENTATION
#include <carbon.h>

#include <x.h>
#include <x_test.h>

static bool_t x_test_inc_int(void) {
  int a = 1, b = 0;
  carbon_should_not_be(a, b);
  inc_int(&b);
  carbon_should_be(a, b);
  return true;
}

void x_test_register(void) {
  CARBON_REGISTER_TEST(x_test_inc_int);
}
#+end_src

(...)

- ~$CC~ :: ~gcc~
- ~$CPPFLAGS~ :: ~-I include~
- ~$CFLAGS~ :: ~-Wall -Wextra -pedantic -Werror -fanalyzer~
#+begin_src sh
$  $CC $CPPFLAGS $CFLAGS -c test/src/x_test.c -o build/test/x_test.o
#+end_src

** Test suite entrypoint

(...)

#+begin_src c
// test/src/test.c

#define CARBON_IMPLEMENTATION
#include <carbon.h>

#include <x_test.h>

int main(void) {
  x_test_register();

  carbon_test_manager_run();
  return 0;
}
#+end_src

(...)

- ~$CC~ :: ~gcc~
- ~$CCOVFLAGS~ :: ~-fprofile-arcs -ftest-coverage~
- ~$LDFLAGS~ :: ~-Wl,--build-id -L . -lx~
#+begin_src sh
$  $CC $CCOVFLAGS build/test/x_test.o $LDFLAGS -o build/test/test
#+end_src

* Code coverage

(...)
